<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    html, body {
      margin: 0;
      padding: 0;
      background-color: black;
      height: 100vh;
      overflow: auto;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }

    svg {
      display: block;
      max-width: 100vw;
      height: 100%;
      width: auto;
    }

    .image-mapper-shape {
      fill: transparent;
      stroke: yellow;
      stroke-width: 2px;
      transform-origin: center center;
      transition: transform 0.25s ease, filter 0.25s ease;
    }
    .image-mapper-shape.red { stroke: red; }
    .image-mapper-shape.blue { stroke: blue; }

    .zoom-part {
      pointer-events: none;
      transition: transform 0.25s ease, filter 0.25s ease, opacity 0.25s ease;
      image-rendering: auto;
    }
  </style>
</head>

<body>
  <svg xmlns="http://www.w3.org/2000/svg" 
       xmlns:xlink="http://www.w3.org/1999/xlink" 
       viewBox="0 0 2048 2454"
       preserveAspectRatio="xMidYMid meet">

    <defs id="clip-defs"></defs>

    <!-- =======================
         المجموعة الأولى
    ========================== -->
    <g id="main-group" transform="translate(0,0)">
      <image href="image/1.png" width="1024" height="2454"/>

      <a href="micro/1.pdf"><rect x="368" y="703" width="115" height="380" class="image-mapper-shape"/></a>
      <a href="patho/1.pdf"><rect x="368" y="1083" width="115" height="253.5" class="image-mapper-shape"/></a>
      <a href="patho/q/1.pdf"><rect x="368" y="1339" width="115" height="125" class="image-mapper-shape red"/></a>
      <a href="physio/2.pdf"><rect x="368" y="1465" width="115" height="380" class="image-mapper-shape"/></a>
      <a href="anatomy/1.pdf"><rect x="368" y="1845" width="115" height="380" class="image-mapper-shape"/></a>
      <a href="physio/1.pdf"><rect x="598" y="366" width="114.5" height="315" class="image-mapper-shape"/></a>
      <a href="histo/1.pdf"><rect x="712.35" y="702" width="115" height="380" class="image-mapper-shape"/></a>
      <a href="anatomy/2.pdf"><rect x="712.35" y="1465" width="115" height="380" class="image-mapper-shape"/></a>
      <a href="physio/2.pdf"><rect x="598" y="1846" width="115" height="253.4" class="image-mapper-shape"/></a>
      <a href="physio/q/1.pdf"><rect x="598" y="2100" width="115" height="127" class="image-mapper-shape red"/></a>
    </g>

    <!-- =======================
         المجموعة الثانية
    ========================== -->
    <g id="secondary-group" transform="translate(1024,0)">
      <image href="2.png" width="1024" height="2454"/>

      <a href="https://drive.google.com">
      <rect x="137.6" y="477.1" width="115" height="257.4" class="image-mapper-shape blue"/></a>

      <a href="pharma/1.pdf"><rect x="137.9" y="875.8" width="114.8" height="469.8" class="image-mapper-shape"/></a>
      <a href="#"><rect x="137.7" y="1827.9" width="115.1" height="431.3" class="image-mapper-shape"/></a>
      <a href="#"><rect x="367.9" y="1344.9" width="115.7" height="482.8" class="image-mapper-shape"/></a>
      <a href="#"><rect x="483.5" y="1104.3" width="114.1" height="361.9" class="image-mapper-shape"/></a>
      <a href="#"><rect x="597.5" y="1465.7" width="114.6" height="362.6" class="image-mapper-shape"/></a>
      <a href="#"><rect x="711.6" y="477.0" width="114.7" height="377.8" class="image-mapper-shape"/></a>
      <a href="#"><rect x="137.7" y="348.5" width="114.4" height="129.1" class="image-mapper-shape"/></a>
      <a href="#"><rect x="712.5" y="1345.1" width="114.0" height="482.9" class="image-mapper-shape"/></a>
    </g>
  </svg>

  <script>
    /* ================
       تحديد نوع الجهاز
    ================== */
    const isMobile = /Android|iPhone|iPad|iPod|Mobile/i.test(navigator.userAgent);

    document.querySelectorAll('a').forEach(a => {
      a.removeAttribute('target');
      if (!isMobile) a.setAttribute('target', '_blank');
    });

    const clipDefs = document.getElementById('clip-defs');
    let activeRect = null;

    /* ================
        تفعيل الـ hover
    ================== */
    function attachHover(rect, index) {
      let zoomPart = null;
      let glowTimer = null;

      const parentGroup = rect.closest('g');
      if (!parentGroup) return;

      const baseImg = parentGroup.querySelector('image');
      if (!baseImg) return;

      const imgW = baseImg.width.baseVal.value;
      const imgH = baseImg.height.baseVal.value;
      const imgSrc = baseImg.getAttribute('href');

      const clipId = "clip_" + Date.now() + "_" + index;

      rect.addEventListener("mouseover", start);
      rect.addEventListener("mouseout", stop);

      rect.addEventListener("touchstart", e => {
        e.preventDefault();
        if (activeRect && activeRect !== rect) stop();
        start();
      });

      document.body.addEventListener("touchstart", e => {
        if (activeRect && !rect.contains(e.target)) stop();
      });

      function start() {
        if (activeRect === rect) return;
        activeRect = rect;

        /* حذف أي clip قديم بنفس الاسم */
        const oldClip = document.getElementById(clipId);
        if (oldClip) oldClip.remove();

        const x = +rect.getAttribute("x");
        const y = +rect.getAttribute("y");
        const w = +rect.getAttribute("width");
        const h = +rect.getAttribute("height");

        /* إنشاء clipPath */
        const cp = document.createElementNS("http://www.w3.org/2000/svg", "clipPath");
        cp.id = clipId;

        const cpRect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
        cpRect.setAttribute("x", x);
        cpRect.setAttribute("y", y);
        cpRect.setAttribute("width", w);
        cpRect.setAttribute("height", h);

        cp.appendChild(cpRect);
        clipDefs.appendChild(cp);

        /* إنشاء صورة الزوم */
        zoomPart = document.createElementNS("http://www.w3.org/2000/svg", "image");
        zoomPart.setAttribute("href", imgSrc);
        zoomPart.setAttribute("width", imgW);
        zoomPart.setAttribute("height", imgH);
        zoomPart.setAttribute("class", "zoom-part");
        zoomPart.setAttribute("clip-path", `url(#${clipId})`);
        zoomPart.style.transformOrigin = `${x + w/2}px ${y + h/2}px`;
        zoomPart.style.opacity = 0;

        parentGroup.appendChild(zoomPart);

        /* تطبيق الزوم */
        rect.style.transform = "scale(1.1)";
        zoomPart.style.transform = "scale(1.1)";
        zoomPart.style.opacity = 1;

        /* تأثير الإضاءة */
        let hue = 0;
        glowTimer = setInterval(() => {
          hue = (hue + 3) % 360;
          const glow = `drop-shadow(0 0 10px hsl(${hue}, 100%, 60%))`;
          rect.style.filter = glow;
          zoomPart.style.filter = glow;
        }, 50);
      }

      function stop() {
        if (glowTimer) clearInterval(glowTimer);
        rect.style.transform = "scale(1)";
        rect.style.filter = "none";

        if (zoomPart) zoomPart.remove();
        const old = document.getElementById(clipId);
        if (old) old.remove();

        if (activeRect === rect) activeRect = null;
      }
    }

    /* تفعيل جميع المستطيلات */
    [...document.querySelectorAll('.image-mapper-shape')]
      .forEach((rect, i) => attachHover(rect, i));

  </script>
</body>
</html>